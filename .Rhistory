"MMSE", "SNSB_attention", "SNSB_language", "SNSB_visuospatial", "SNSB_memory", "SNSB_frontal",
"bmi", "whr", "pbcm", "pbf", "bmr", "ecw_tcw", "tbw_ffm", "PA50_total",
"ECW_ICW_upper", "ECW_ICW_lower", "Water_Lean_upper", "Water_Lean_lower",
"R_upper", "R_lower", "Xc_upper", "Xc_lower", "PA_upper", "PA_lower",
"R_H_upper", "R_H_lower", "Xc_H_upper", "Xc_H_lower"
)
# --- Batch Analysis ---
results <- lapply(biavars, function(var) {
print(paste("Analyzing:", var))
analyze_longitudinal_trends_LRT(
data = df_long.analysis,
response = var,
groupvar = "Change_Type",
referencegroup = referencegroup,
comparisongroups = comparisongroups
)
})
modelsummarylist <- lapply(results, function(x) x$modelsummary)
allsummaries <- bind_rows(modelsummarylist, .id = "Biomarker")
write.csv(allsummaries, "Bioimpedance_LME_LRT_summary.csv", row.names = FALSE)
print("Check complete: Output summary table written!")
# --- Batch Plot Generation (Wald + LRT) ---
output_dir_wald <- "Bioimpedance_Trajectory_WaldPlots"
output_dir_lrt <- "Bioimpedance_Trajectory_LRTPlots"
dir.create(output_dir_wald, showWarnings = FALSE)
dir.create(output_dir_lrt, showWarnings = FALSE)
plots_wald <- lapply(biavars, function(var)
plot_lmer_model_with_interaction_p(
data = df_long.analysis,
response = var,
colors = colors.legend
)
)
plots_lrt <- lapply(biavars, function(var)
plot_lmer_interaction_with_p(
data = df_long.analysis,
response = var,
colors = colors.legend,
show.legend = FALSE
)
)
for (i in seq_along(biavars)) {
pw <- plots_wald[[i]]
pl <- plots_lrt[[i]]
if (inherits(pw, "ggplot")) {
ggsave(
filename = file.path(output_dir_wald, paste0(biavars[i], "_waldplot.png")),
plot = pw, width = 7, height = 5, dpi = 300
)
}
if (inherits(pl, "ggplot")) {
ggsave(
filename = file.path(output_dir_lrt, paste0(biavars[i], "_lrtplot.png")),
plot = pl, width = 7, height = 5, dpi = 300
)
}
}
library(performance)
if (!dir.exists("Diagnostics")) dir.create("Diagnostics")
safe_var_extract <- function(vardf, grpval, var1val, var2val) {
idx <- which(vardf$grp==grpval & vardf$var1==var1val & vardf$var2==var2val)
if(length(idx)==1 && !is.na(vardf$vcov[idx])) vardf$vcov[idx] else NA_real_
}
safe_r2 <- function(model) {
out <- tryCatch(
suppressWarnings(performance::r2(model)),
error = function(e) list(R2_marginal=NA_real_, R2_conditional=NA_real_)
)
list(marginal=out$R2_marginal, conditional=out$R2_conditional)
}
diagnostics_list <- lapply(seq_along(biavars), function(i) {
var <- biavars[i]
m <- results[[i]]$mod_full
png(filename = sprintf("Diagnostics/%s_QQplot.png", var), width = 700, height = 700)
qqnorm(residuals(m)); qqline(residuals(m)); dev.off()
png(filename = sprintf("Diagnostics/%s_ResVsFitted.png", var), width = 700, height = 700)
plot(fitted(m), residuals(m), main = paste(var, "Fitted vs Residuals"),
xlab = "Fitted Values", ylab = "Residuals"); abline(h = 0, lty = 2); dev.off()
aic <- tryCatch(AIC(m), error=function(e) NA_real_)
bic <- tryCatch(BIC(m), error=function(e) NA_real_)
r2 <- safe_r2(m)
ranef_var <- tryCatch(as.data.frame(VarCorr(m)), error=function(e) data.frame())
rand_intercept <- if(nrow(ranef_var)>0) safe_var_extract(ranef_var,"USUBJID","","") else NA_real_
rand_slope <- if(nrow(ranef_var)>0) safe_var_extract(ranef_var,"USUBJID","elapsed_years","") else NA_real_
conv_warn <- if (!is.null(m@optinfo$conv$lme4$messages)) paste(m@optinfo$conv$lme4$messages, collapse="; ") else NA
singular_flag <- if (isSingular(m, tol=1e-4)) "singular" else NA
data.frame(Biomarker = var,
AIC = aic, BIC = bic,
Marginal_R2 = r2$marginal,
Conditional_R2 = r2$conditional,
RandomInterceptVar = rand_intercept,
RandomSlopeVar = rand_slope,
ConvergenceWarning = conv_warn,
SingularFit = singular_flag)
})
diagnostics_df <- do.call(rbind, diagnostics_list)
write.csv(diagnostics_df, "Diagnostics/Bioimpedance_LME_diagnostics.csv", row.names = FALSE)
df <- read.csv("Chosun5yBIApreprocess.csv", stringsAsFactors = FALSE)
df <- df %>% filter(!(k_no %in% remove_list))
df <- df %>%
mutate(datetest = as.Date(datetest, format = "%m/%d/%Y"))
df2 <- df %>%
group_by(USUBJID) %>%
filter(n() >= 2) %>%
ungroup()
df2 <- df2 %>%
arrange(USUBJID, datetest)
df3 <- df2 %>%
group_by(USUBJID) %>%
mutate(
Initial_Status = first(diagnosis),
Final_Status = last(diagnosis),
Transition     = paste(Initial_Status, "-", Final_Status),
Change_Type    = case_when(
Initial_Status == "CN"  & Final_Status == "CN"  ~ "StableCN",
Initial_Status == "CN"  & Final_Status == "MCI" ~ "CNtransitMCI",
Initial_Status == "MCI" & Final_Status == "CN"  ~ "MCItransitCN",
Initial_Status == "MCI" & Final_Status == "MCI" ~ "StableMCI",
Initial_Status == "MCI" & Final_Status == "AD"  ~ "MCItransitAD",
Initial_Status == "CN"  & Final_Status == "AD"  ~ "CNtransitAD",
Initial_Status == "AD"  & Final_Status == "MCI" ~ "ADtransitMCI",
Initial_Status == "AD"  & Final_Status == "CN"  ~ "ADtransitCN",
Initial_Status == "AD"  & Final_Status == "AD"  ~ "StableAD",
TRUE ~ NA_character_
),
visit_count = n(),
baseline_date = first(datetest),
elapsed_years = as.numeric(difftime(datetest, baseline_date, units = "days")) / 365.25,
elapsed_years_First_to_Last = as.numeric(difftime(last(datetest), first(datetest), units = "days")) / 365.25
) %>%
ungroup()
df4 <- df3 %>%
filter(elapsed_years_First_to_Last >= 0.916666666)
#write.csv(df4, "df4.csv",row.names = FALSE)
group_counts <- df4 %>%
group_by(Transition, Change_Type) %>%
summarise(count = n()) %>%
mutate(percentage = count / sum(count) * 100)
print(head(df4))
print(group_counts)
# Unique participant-level summary for each Transition and Change_Type group
participant_group_summary <- df4 %>%
group_by(USUBJID) %>%
summarise(
Transition = first(Transition),
Change_Type = first(Change_Type)
) %>%
group_by(Transition, Change_Type) %>%
summarise(
n_participants = n(),
participants = paste(USUBJID, collapse = ", ")
) %>%
ungroup()
print(participant_group_summary)
df <- read.csv("Chosun5yBIApreprocess.csv", stringsAsFactors = FALSE)
df <- df %>% filter(!(k_no %in% remove_list))
df <- df %>%
mutate(datetest = as.Date(datetest, format = "%m/%d/%Y"))
df2 <- df %>%
group_by(USUBJID) %>%
filter(n() >= 2) %>%
ungroup()
df2 <- df2 %>%
arrange(USUBJID, datetest)
df3 <- df2 %>%
group_by(USUBJID) %>%
mutate(
Initial_Status = first(diagnosis),
Final_Status = last(diagnosis),
Transition     = paste(Initial_Status, "-", Final_Status),
Change_Type    = case_when(
Initial_Status == "CN"  & Final_Status == "CN"  ~ "StableCN",
Initial_Status == "CN"  & Final_Status == "MCI" ~ "CNtransitMCI",
Initial_Status == "MCI" & Final_Status == "CN"  ~ "MCItransitCN",
Initial_Status == "MCI" & Final_Status == "MCI" ~ "StableMCI",
Initial_Status == "MCI" & Final_Status == "AD"  ~ "MCItransitAD",
Initial_Status == "CN"  & Final_Status == "AD"  ~ "CNtransitAD",
Initial_Status == "AD"  & Final_Status == "MCI" ~ "ADtransitMCI",
Initial_Status == "AD"  & Final_Status == "CN"  ~ "ADtransitCN",
Initial_Status == "AD"  & Final_Status == "AD"  ~ "StableAD",
TRUE ~ NA_character_
),
visit_count = n(),
baseline_date = first(datetest),
elapsed_years = as.numeric(difftime(datetest, baseline_date, units = "days")) / 365.25,
elapsed_years_First_to_Last = as.numeric(difftime(last(datetest), first(datetest), units = "days")) / 365.25
) %>%
ungroup()
df4 <- df3 %>%
filter(elapsed_years_First_to_Last >= 0.916666666)
#write.csv(df4, "df4.csv",row.names = FALSE)
group_counts <- df4 %>%
group_by(Transition, Change_Type) %>%
summarise(count = n()) %>%
mutate(percentage = count / sum(count) * 100)
print(head(df4))
print(group_counts)
# Unique participant-level summary for each Transition and Change_Type group
participant_group_summary <- df4 %>%
group_by(USUBJID) %>%
summarise(
Transition = first(Transition),
Change_Type = first(Change_Type)
) %>%
group_by(Transition, Change_Type) %>%
summarise(
n_participants = n(),
participants = paste(USUBJID, collapse = ", ")
) %>%
ungroup()
print(participant_group_summary)
# Data manipulation
library(dplyr)
library(tidyr)
library(tibble)
library(lubridate)
library(stringr)
# Visualization
library(ggplot2)
library(cowplot)
library(ggpubr)
library(patchwork)
library(sjPlot)
# Statistical analysis
library(lme4)
library(rstatix)
library(effectsize)
library(emmeans)
library(broom)
library(broom.mixed)
# Reporting
library(gtsummary)
library(flextable)
library(summarytools)
library(tableone)
library(effsize)
library(scales)
library(tidyverse)
df <- read.csv("Chosun5yBIApreprocess.csv", stringsAsFactors = FALSE)
df <- df %>%
mutate(datetest = as.Date(datetest, format = "%m/%d/%Y"))
df2 <- df %>%
group_by(USUBJID) %>%
filter(n() >= 2) %>%
ungroup()
df2 <- df2 %>%
arrange(USUBJID, datetest)
df3 <- df2 %>%
group_by(USUBJID) %>%
mutate(
Initial_Status = first(diagnosis),
Final_Status = last(diagnosis),
Transition     = paste(Initial_Status, "-", Final_Status),
Change_Type    = case_when(
Initial_Status == "CN"  & Final_Status == "CN"  ~ "StableCN",
Initial_Status == "CN"  & Final_Status == "MCI" ~ "CNtransitMCI",
Initial_Status == "MCI" & Final_Status == "CN"  ~ "MCItransitCN",
Initial_Status == "MCI" & Final_Status == "MCI" ~ "StableMCI",
Initial_Status == "MCI" & Final_Status == "AD"  ~ "MCItransitAD",
Initial_Status == "CN"  & Final_Status == "AD"  ~ "CNtransitAD",
Initial_Status == "AD"  & Final_Status == "MCI" ~ "ADtransitMCI",
Initial_Status == "AD"  & Final_Status == "CN"  ~ "ADtransitCN",
Initial_Status == "AD"  & Final_Status == "AD"  ~ "StableAD",
TRUE ~ NA_character_
),
visit_count = n(),
baseline_date = first(datetest),
elapsed_years = as.numeric(difftime(datetest, baseline_date, units = "days")) / 365.25,
elapsed_years_First_to_Last = as.numeric(difftime(last(datetest), first(datetest), units = "days")) / 365.25
) %>%
ungroup()
df4 <- df3 %>%
filter(elapsed_years_First_to_Last >= 0.916666666)
#write.csv(df4, "df4.csv",row.names = FALSE)
group_counts <- df4 %>%
group_by(Transition, Change_Type) %>%
summarise(count = n()) %>%
mutate(percentage = count / sum(count) * 100)
print(head(df4))
print(group_counts)
# Unique participant-level summary for each Transition and Change_Type group
participant_group_summary <- df4 %>%
group_by(USUBJID) %>%
summarise(
Transition = first(Transition),
Change_Type = first(Change_Type)
) %>%
group_by(Transition, Change_Type) %>%
summarise(
n_participants = n(),
participants = paste(USUBJID, collapse = ", ")
) %>%
ungroup()
print(participant_group_summary)
df <- read.csv("Chosun5yBIApreprocess.csv", stringsAsFactors = FALSE)
df <- df %>%
mutate(datetest = as.Date(datetest, format = "%m/%d/%Y"))
df2 <- df %>%
group_by(USUBJID) %>%
filter(n() >= 2) %>%
ungroup()
df2 <- df2 %>%
arrange(USUBJID, datetest)
df3 <- df2 %>%
group_by(USUBJID) %>%
mutate(
Initial_Status = first(diagnosis),
Final_Status = last(diagnosis),
Transition     = paste(Initial_Status, "-", Final_Status),
Change_Type    = case_when(
Initial_Status == "CN"  & Final_Status == "CN"  ~ "StableCN",
Initial_Status == "CN"  & Final_Status == "MCI" ~ "CNtransitMCI",
Initial_Status == "MCI" & Final_Status == "CN"  ~ "MCItransitCN",
Initial_Status == "MCI" & Final_Status == "MCI" ~ "StableMCI",
Initial_Status == "MCI" & Final_Status == "AD"  ~ "MCItransitAD",
Initial_Status == "CN"  & Final_Status == "AD"  ~ "CNtransitAD",
Initial_Status == "AD"  & Final_Status == "MCI" ~ "ADtransitMCI",
Initial_Status == "AD"  & Final_Status == "CN"  ~ "ADtransitCN",
Initial_Status == "AD"  & Final_Status == "AD"  ~ "StableAD",
TRUE ~ NA_character_
),
visit_count = n(),
baseline_date = first(datetest),
elapsed_years = as.numeric(difftime(datetest, baseline_date, units = "days")) / 365.25,
elapsed_years_First_to_Last = as.numeric(difftime(last(datetest), first(datetest), units = "days")) / 365.25
) %>%
ungroup()
group_counts <- df4 %>%
group_by(Transition, Change_Type) %>%
summarise(count = n()) %>%
mutate(percentage = count / sum(count) * 100)
print(head(df4))
print(group_counts)
# Unique participant-level summary for each Transition and Change_Type group
participant_group_summary <- df4 %>%
group_by(USUBJID) %>%
summarise(
Transition = first(Transition),
Change_Type = first(Change_Type)
) %>%
group_by(Transition, Change_Type) %>%
summarise(
n_participants = n(),
participants = paste(USUBJID, collapse = ", ")
) %>%
ungroup()
print(participant_group_summary)
# Data manipulation
library(dplyr)
library(tidyr)
library(tibble)
library(lubridate)
library(stringr)
# Visualization
library(ggplot2)
library(cowplot)
library(ggpubr)
library(patchwork)
library(sjPlot)
# Statistical analysis
library(lme4)
library(rstatix)
library(effectsize)
library(emmeans)
library(broom)
library(broom.mixed)
# Reporting
library(gtsummary)
library(flextable)
library(summarytools)
library(tableone)
library(effsize)
library(scales)
library(tidyverse)
df <- read.csv("Chosun5yBIApreprocess.csv", stringsAsFactors = FALSE)
df <- df %>%
mutate(datetest = as.Date(datetest, format = "%m/%d/%Y"))
df2 <- df %>%
group_by(USUBJID) %>%
filter(n() >= 2) %>%
ungroup()
df2 <- df2 %>%
arrange(USUBJID, datetest)
df3 <- df2 %>%
group_by(USUBJID) %>%
mutate(
Initial_Status = first(diagnosis),
Final_Status = last(diagnosis),
Transition     = paste(Initial_Status, "-", Final_Status),
Change_Type    = case_when(
Initial_Status == "CN"  & Final_Status == "CN"  ~ "StableCN",
Initial_Status == "CN"  & Final_Status == "MCI" ~ "CNtransitMCI",
Initial_Status == "MCI" & Final_Status == "CN"  ~ "MCItransitCN",
Initial_Status == "MCI" & Final_Status == "MCI" ~ "StableMCI",
Initial_Status == "MCI" & Final_Status == "AD"  ~ "MCItransitAD",
Initial_Status == "CN"  & Final_Status == "AD"  ~ "CNtransitAD",
Initial_Status == "AD"  & Final_Status == "MCI" ~ "ADtransitMCI",
Initial_Status == "AD"  & Final_Status == "CN"  ~ "ADtransitCN",
Initial_Status == "AD"  & Final_Status == "AD"  ~ "StableAD",
TRUE ~ NA_character_
),
visit_count = n(),
baseline_date = first(datetest),
elapsed_years = as.numeric(difftime(datetest, baseline_date, units = "days")) / 365.25,
elapsed_years_First_to_Last = as.numeric(difftime(last(datetest), first(datetest), units = "days")) / 365.25
) %>%
ungroup()
group_counts <- df4 %>%
group_by(Transition, Change_Type) %>%
summarise(count = n()) %>%
mutate(percentage = count / sum(count) * 100)
print(head(df4))
print(group_counts)
# Unique participant-level summary for each Transition and Change_Type group
participant_group_summary <- df4 %>%
group_by(USUBJID) %>%
summarise(
Transition = first(Transition),
Change_Type = first(Change_Type)
) %>%
group_by(Transition, Change_Type) %>%
summarise(
n_participants = n(),
participants = paste(USUBJID, collapse = ", ")
) %>%
ungroup()
print(participant_group_summary)
# Data manipulation
library(dplyr)
library(tidyr)
library(tibble)
library(lubridate)
library(stringr)
# Visualization
library(ggplot2)
library(cowplot)
library(ggpubr)
library(patchwork)
library(sjPlot)
# Statistical analysis
library(lme4)
library(rstatix)
library(effectsize)
library(emmeans)
library(broom)
library(broom.mixed)
# Reporting
library(gtsummary)
library(flextable)
library(summarytools)
library(tableone)
library(effsize)
library(scales)
library(tidyverse)
df <- read.csv("Chosun5yBIApreprocess.csv", stringsAsFactors = FALSE)
remove_list <- c("E_237", "F_242", "a_531", "E_391", "G_31", "F_385", "a_281")
df <- df %>% filter(!(k_no %in% remove_list))
df <- df %>%
mutate(datetest = as.Date(datetest, format = "%m/%d/%Y"))
df2 <- df %>%
group_by(USUBJID) %>%
filter(n() >= 2) %>%
ungroup()
df2 <- df2 %>%
arrange(USUBJID, datetest)
df3 <- df2 %>%
group_by(USUBJID) %>%
mutate(
Initial_Status = first(diagnosis),
Final_Status = last(diagnosis),
Transition     = paste(Initial_Status, "-", Final_Status),
Change_Type    = case_when(
Initial_Status == "CN"  & Final_Status == "CN"  ~ "StableCN",
Initial_Status == "CN"  & Final_Status == "MCI" ~ "CNtransitMCI",
Initial_Status == "MCI" & Final_Status == "CN"  ~ "MCItransitCN",
Initial_Status == "MCI" & Final_Status == "MCI" ~ "StableMCI",
Initial_Status == "MCI" & Final_Status == "AD"  ~ "MCItransitAD",
Initial_Status == "CN"  & Final_Status == "AD"  ~ "CNtransitAD",
Initial_Status == "AD"  & Final_Status == "MCI" ~ "ADtransitMCI",
Initial_Status == "AD"  & Final_Status == "CN"  ~ "ADtransitCN",
Initial_Status == "AD"  & Final_Status == "AD"  ~ "StableAD",
TRUE ~ NA_character_
),
visit_count = n(),
baseline_date = first(datetest),
elapsed_years = as.numeric(difftime(datetest, baseline_date, units = "days")) / 365.25,
elapsed_years_First_to_Last = as.numeric(difftime(last(datetest), first(datetest), units = "days")) / 365.25
) %>%
ungroup()
df4 <- df3 %>%
filter(elapsed_years_First_to_Last >= 0.916666666)
#write.csv(df4, "df4.csv",row.names = FALSE)
group_counts <- df4 %>%
group_by(Transition, Change_Type) %>%
summarise(count = n()) %>%
mutate(percentage = count / sum(count) * 100)
print(head(df4))
print(group_counts)
# Unique participant-level summary for each Transition and Change_Type group
participant_group_summary <- df4 %>%
group_by(USUBJID) %>%
summarise(
Transition = first(Transition),
Change_Type = first(Change_Type)
) %>%
group_by(Transition, Change_Type) %>%
summarise(
n_participants = n(),
participants = paste(USUBJID, collapse = ", ")
) %>%
ungroup()
print(participant_group_summary)
