Final_Status   = last(COGNITIVESTAT),
baseline_date  = first(datetest),
elapsed_years  = as.numeric(difftime(datetest, baseline_date, units="days")) / 365.25,
Transition     = paste(Initial_Status, "->", Final_Status),
Change_Type    = case_when(
Initial_Status == "CN" & Final_Status == "CN" ~ "StableCN",
Initial_Status == "CN" & Final_Status == "MCI" ~ "ProgressiveCN",
TRUE ~ NA_character_
)
) %>%
ungroup() %>%
select(-baseline_date)
print(df_overall)
df_long.analysis <- df_overall %>%
drop_na() %>%
mutate_if(is.character, as.factor) %>%
droplevels() %>%
add_count(USUBJID, name = "visit_count")
df_long.analysis$Change_Type <- relevel(factor(df_long.analysis$Change_Type), ref = "StableCN")
view(dfSummary(df.long_multi ))
df_transition_summary <- df.long_multi %>%
arrange(USUBJID, datetest) %>%
group_by(USUBJID) %>%
summarise(
Initial_Status = first(COGNITIVESTAT),
Final_Status = last(COGNITIVESTAT),
Transition = paste(Initial_Status, "->", Final_Status)
) %>%
group_by(Transition) %>%
summarise(
Count = n(),
.groups = "drop"
) %>%
mutate(
Percentage = round(Count / sum(Count) * 100, 1)
) %>%
arrange(desc(Count))
print(df_transition_summary)
df_long.analysis <- df_overall %>%
drop_na() %>%
mutate_if(is.character, as.factor) %>%
droplevels() %>%
add_count(USUBJID, name = "visit_count")
df_long.analysis$Change_Type <- relevel(factor(df_long.analysis$Change_Type), ref = "StableCN")
df_transition_summary <- df.long_multi %>%
arrange(USUBJID, datetest) %>%
group_by(USUBJID) %>%
summarise(
Initial_Status = first(COGNITIVESTAT),
Final_Status = last(COGNITIVESTAT),
Transition = paste(Initial_Status, "->", Final_Status)
) %>%
group_by(Transition) %>%
summarise(
Count = n(),
.groups = "drop"
) %>%
mutate(
Percentage = round(Count / sum(Count) * 100, 1)
) %>%
arrange(desc(Count))
print(df_transition_summary)
df_long.analysis <- df_overall %>%
drop_na() %>%
mutate_if(is.character, as.factor) %>%
droplevels() %>%
add_count(USUBJID, name = "visit_count")
df_transition_summary <- df.long_multi %>%
arrange(USUBJID, datetest) %>%
group_by(USUBJID) %>%
summarise(
Initial_Status = first(COGNITIVESTAT),
Final_Status = last(COGNITIVESTAT),
Transition = paste(Initial_Status, "->", Final_Status)
) %>%
group_by(Transition) %>%
summarise(
Count = n(),
.groups = "drop"
) %>%
mutate(
Percentage = round(Count / sum(Count) * 100, 1)
) %>%
arrange(desc(Count))
print(df_transition_summary)
df.long_multi <- df.long %>%
group_by(USUBJID) %>%
filter(n() >= 2) %>%
ungroup()
df_overall <- df.long_multi %>%
mutate(
COGNITIVESTAT = case_when(
COGNITIVESTAT %in% c("aMCI", "naMCI") ~ "MCI",
COGNITIVESTAT == "SMI" ~ "CN",
TRUE ~ COGNITIVESTAT
),
datetest = mdy(datetest)
) %>%
arrange(USUBJID, datetest) %>%
group_by(USUBJID) %>%
mutate(
Initial_Status = first(COGNITIVESTAT),
Final_Status   = last(COGNITIVESTAT),
baseline_date  = first(datetest),
elapsed_years  = as.numeric(difftime(datetest, baseline_date, units="days")) / 365.25,
Transition     = paste(Initial_Status, "->", Final_Status),
Change_Type    = case_when(
Initial_Status == "CN" & Final_Status == "CN" ~ "StableCN",
Initial_Status == "CN" & Final_Status == "MCI" ~ "ProgressiveCN",
Initial_Status == "MCI" & Final_Status == "CN" ~ "RevertedMCI"
Initial_Status == "MCI" & Final_Status == "MCI" ~ "StableMCI"
df.long_multi <- df.long %>%
group_by(USUBJID) %>%
filter(n() >= 2) %>%
ungroup()
df_overall <- df.long_multi %>%
mutate(
COGNITIVESTAT = case_when(
COGNITIVESTAT %in% c("aMCI", "naMCI") ~ "MCI",
COGNITIVESTAT == "SMI" ~ "CN",
TRUE ~ COGNITIVESTAT
),
datetest = mdy(datetest)
) %>%
arrange(USUBJID, datetest) %>%
group_by(USUBJID) %>%
mutate(
Initial_Status = first(COGNITIVESTAT),
Final_Status   = last(COGNITIVESTAT),
baseline_date  = first(datetest),
elapsed_years  = as.numeric(difftime(datetest, baseline_date, units="days")) / 365.25,
Transition     = paste(Initial_Status, "->", Final_Status),
Change_Type    = case_when(
Initial_Status == "CN" & Final_Status == "CN" ~ "StableCN",
Initial_Status == "CN" & Final_Status == "MCI" ~ "ProgressiveCN",
TRUE ~ NA_character_
)
) %>%
ungroup() %>%
select(-baseline_date)
print(df_overall)
# --- 2. Read and Prepare Data ---
setwd("C:/Users/KIOM_USER/Documents/GitHub/LongitudinalNC")
df <- read.csv("Chosun5yBIApreprocess.csv",
header = TRUE, stringsAsFactors = FALSE, na.strings = c("", "NA"))
df$COGNITIVESTAT <- df$COGNITIVESTAT %>%
str_replace_all("\\.", "")   %>%      # Remove all dots
str_trim(side = "both")       # Remove leading/trailing spaces
df <- df %>% add_count(USUBJID, name = "visit_count")
df.long <- df %>%
filter(!is.na(COGNITIVESTAT) & COGNITIVESTAT != "") %>%
drop_na() %>%
add_count(USUBJID, name = "visit_count") %>%
mutate(
COGNITIVESTAT = case_when(
COGNITIVESTAT %in% c("SMI") ~ "CN",
COGNITIVESTAT %in% c("aMCI", "naMCI") ~ "MCI",
TRUE ~ COGNITIVESTAT
)
)
print(df.long)
# --- 2. Read and Prepare Data ---
setwd("C:/Users/KIOM_USER/Documents/GitHub/LongitudinalNC")
df <- read.csv("Chosun5yBIApreprocess.csv",
header = TRUE, stringsAsFactors = FALSE, na.strings = c("", "NA"))
df <- df %>% add_count(USUBJID, name = "visit_count")
df.long <- df %>%
filter(!is.na(COGNITIVESTAT) & COGNITIVESTAT != "") %>%
drop_na() %>%
add_count(USUBJID, name = "visit_count") %>%
)
# --- 1. Load Packages ---
library(ggplot2)
library(tidyr)
library(dplyr)
library(ggpubr)
library(gtsummary)
library(flextable)
library(tidyverse)
library(rstatix)
library(ggpubr)
library(summarytools)
library(cowplot)
library(patchwork)
# --- LOAD AT START OF SESSION ---
library(lmerTest)
library(broom.mixed)
library(emmeans)
library(stringr)
#library(lme4)
library(sjPlot)
# --- 2. Read and Prepare Data ---
setwd("C:/Users/KIOM_USER/Documents/GitHub/LongitudinalNC")
df <- read.csv("Chosun5yBIApreprocess.csv",
header = TRUE, stringsAsFactors = FALSE, na.strings = c("", "NA"))
df <- df %>% add_count(USUBJID, name = "visit_count")
df.long <- df %>%
filter(!is.na(COGNITIVESTAT) & COGNITIVESTAT != "") %>%
drop_na() %>%
add_count(USUBJID, name = "visit_count") %>%
)
# --- 2. Read and Prepare Data ---
setwd("C:/Users/KIOM_USER/Documents/GitHub/LongitudinalNC")
df <- read.csv("Chosun5yBIApreprocess.csv",
header = TRUE, stringsAsFactors = FALSE, na.strings = c("", "NA"))
df$COGNITIVESTAT <- df$COGNITIVESTAT %>%
str_replace_all("\\.", "")   %>%      # Remove all dots
str_trim(side = "both")       # Remove leading/trailing spaces
df <- df %>% add_count(USUBJID, name = "visit_count")
df.long <- df %>%
filter(!is.na(COGNITIVESTAT) & COGNITIVESTAT != "") %>%
drop_na() %>%
add_count(USUBJID, name = "visit_count") %>%
mutate(
COGNITIVESTAT = case_when(
COGNITIVESTAT %in% c("SMI") ~ "CN",
COGNITIVESTAT %in% c("aMCI", "naMCI") ~ "MCI",
TRUE ~ COGNITIVESTAT
)
)
print(df.long)
df.long_multi <- df.long %>%
group_by(USUBJID) %>%
filter(n() >= 2) %>%
ungroup()
df_overall <- df.long_multi %>%
mutate(
COGNITIVESTAT = case_when(
COGNITIVESTAT %in% c("aMCI", "naMCI") ~ "MCI",
COGNITIVESTAT == "SMI" ~ "CN",
TRUE ~ COGNITIVESTAT
),
datetest = mdy(datetest)
) %>%
arrange(USUBJID, datetest) %>%
group_by(USUBJID) %>%
mutate(
Initial_Status = first(COGNITIVESTAT),
Final_Status   = last(COGNITIVESTAT),
baseline_date  = first(datetest),
elapsed_years  = as.numeric(difftime(datetest, baseline_date, units="days")) / 365.25,
Transition     = paste(Initial_Status, "->", Final_Status),
Change_Type    = case_when(
Initial_Status == "CN" & Final_Status == "CN" ~ "StableCN",
Initial_Status == "CN" & Final_Status == "MCI" ~ "ProgressiveCN",
TRUE ~ NA_character_
)
) %>%
ungroup() %>%
select(-baseline_date)
print(df_overall)
library(lubridate)
setwd("C:/Users/KIOM_USER/Documents/GitHub/LongitudinalNC")
df <- read.csv("Chosun5yBIApreprocess.csv",
header = TRUE, stringsAsFactors = FALSE, na.strings = c("", "NA"))
# ----------- 2. Clean and Standardize COGNITIVESTAT -----------
df$COGNITIVESTAT <- df$COGNITIVESTAT %>%
str_replace_all("\\.", "") %>%   # Remove all dots
str_trim(side = "both")          # Remove spaces
# ----------- 3. Add Visit Count Per Subject -----------
df <- df %>%
add_count(USUBJID, name = "visit_count")
# ----------- 4. Filter Valid Cognitive Status & Re-Level -----------
df.long <- df %>%
filter(!is.na(COGNITIVESTAT) & COGNITIVESTAT != "") %>%
drop_na() %>%
add_count(USUBJID, name = "visit_count") %>%
mutate(
COGNITIVESTAT = case_when(
COGNITIVESTAT == "SMI" ~ "CN",
COGNITIVESTAT %in% c("aMCI", "naMCI") ~ "MCI",
TRUE ~ COGNITIVESTAT
)
)
# ----------- 5. Select Subjects with Multiple Visits -----------
df.long_multi <- df.long %>%
group_by(USUBJID) %>%
filter(n() >= 2) %>%
ungroup()
# ----------- 6. Calculate Transitions, Elapsed Time, and Change Types -----------
df_overall <- df.long_multi %>%
mutate(datetest = mdy(datetest)) %>%
arrange(USUBJID, datetest) %>%
group_by(USUBJID) %>%
mutate(
Initial_Status = first(COGNITIVESTAT),
Final_Status   = last(COGNITIVESTAT),
baseline_date  = first(datetest),
elapsed_years  = as.numeric(difftime(datetest, baseline_date, units = "days")) / 365.25,
Transition     = paste(Initial_Status, "->", Final_Status),
Change_Type    = case_when(
Initial_Status == "CN"  & Final_Status == "CN"  ~ "StableCN",
Initial_Status == "CN"  & Final_Status == "MCI" ~ "ProgressiveCN",
Initial_Status == "MCI" & Final_Status == "CN"  ~ "RevertedMCI",
Initial_Status == "MCI" & Final_Status == "MCI" ~ "StableMCI",
Initial_Status == "MCI" & Final_Status == "AD"  ~ "ProgressiveMCI",
Initial_Status == "AD"  & Final_Status == "MCI" ~ "RevertedAD",
Initial_Status == "AD"  & Final_Status == "AD"  ~ "StableAD",
TRUE                                             ~ NA_character_
)
) %>%
ungroup() %>%
select(-baseline_date)
# ----------- 7. Print The Output for Verification -----------
print(head(df_overall, 10))
df_long.analysis <- df_overall %>%
drop_na() %>%
mutate_if(is.character, as.factor) %>%
droplevels() %>%
add_count(USUBJID, name = "visit_count")
df_long.analysis$Change_Type <- relevel(factor(df_long.analysis$Change_Type), ref = "StableCN")
df_transition_summary <- df.long_multi %>%
arrange(USUBJID, datetest) %>%
group_by(USUBJID) %>%
summarise(
Initial_Status = first(COGNITIVESTAT),
Final_Status = last(COGNITIVESTAT),
Transition = paste(Initial_Status, "->", Final_Status)
) %>%
group_by(Transition) %>%
summarise(
Count = n(),
.groups = "drop"
) %>%
mutate(
Percentage = round(Count / sum(Count) * 100, 1)
) %>%
arrange(desc(Count))
print(df_transition_summary)
df_long.analysis <- df_overall %>%
drop_na() %>%
mutate_if(is.character, as.factor) %>%
droplevels() %>%
add_count(USUBJID, name = "visit_count")
df_transition_summary <- df.long_multi %>%
arrange(USUBJID, datetest) %>%
group_by(USUBJID) %>%
summarise(
Initial_Status = first(COGNITIVESTAT),
Final_Status = last(COGNITIVESTAT),
Transition = paste(Initial_Status, "->", Final_Status)
) %>%
group_by(Transition) %>%
summarise(
Count = n(),
.groups = "drop"
) %>%
mutate(
Percentage = round(Count / sum(Count) * 100, 1)
) %>%
arrange(desc(Count))
print(df_transition_summary)
df_long.analysis <- df_overall %>%
mutate_if(is.character, as.factor) %>%
droplevels() %>%
add_count(USUBJID, name = "visit_count")
df_transition_summary <- df.long_multi %>%
arrange(USUBJID, datetest) %>%
group_by(USUBJID) %>%
summarise(
Initial_Status = first(COGNITIVESTAT),
Final_Status = last(COGNITIVESTAT),
Transition = paste(Initial_Status, "->", Final_Status)
) %>%
group_by(Transition) %>%
summarise(
Count = n(),
.groups = "drop"
) %>%
mutate(
Percentage = round(Count / sum(Count) * 100, 1)
) %>%
arrange(desc(Count))
print(df_transition_summary)
df_long.analysis <- df_overall %>%
mutate_if(is.character, as.factor) %>%
add_count(USUBJID, name = "visit_count")
df_transition_summary <- df.long_multi %>%
arrange(USUBJID, datetest) %>%
group_by(USUBJID) %>%
summarise(
Initial_Status = first(COGNITIVESTAT),
Final_Status = last(COGNITIVESTAT),
Transition = paste(Initial_Status, "->", Final_Status)
) %>%
group_by(Transition) %>%
summarise(
Count = n(),
.groups = "drop"
) %>%
mutate(
Percentage = round(Count / sum(Count) * 100, 1)
) %>%
arrange(desc(Count))
print(df_transition_summary)
# ----------- 8. Tạo df_long.analysis với biến visit_count -----------
df_long.analysis <- df.long %>%
add_count(USUBJID, name = "visit_count")
# ----------- 9. Print tóm tắt về Transition (ở bảng df_overall) -----------
cat("Bảng tần suất các loại chuyển trạng thái (Transition):\n")
print(table(df_overall$Transition))
cat("\nBảng tần suất từng dạng Change_Type:\n")
print(table(df_overall$Change_Type))
cat("\nPhân phối số lượng visit_count trên toàn bộ dataset:\n")
print(table(df_long.analysis$visit_count))
# ----------- 1. Create df_long.analysis with visit_count -----------
df_long.analysis <- df_overall %>%
drop_na() %>%                                        # Remove any remaining NAs
mutate_if(is.character, as.factor) %>%                # Convert character columns to factor
droplevels() %>%                                      # Drop unused factor levels
add_count(USUBJID, name = "visit_count")              # Count number of visits per subject
# ----------- 2. Summarize Transition Types (Transition Frequency Table) -----------
df_transition_summary <- df_long.analysis %>%
arrange(USUBJID, datetest) %>%
group_by(USUBJID) %>%
summarise(
Initial_Status = first(Initial_Status),
Final_Status   = last(Final_Status),
Transition     = first(Transition)
) %>%
group_by(Transition) %>%
summarise(
Count      = n(),
Percentage = round(n() / sum(n()) * 100, 1),
.groups = "drop"
) %>%
arrange(desc(Count))
# ----------- 3. Print Transition Summary Table -----------
print(df_transition_summary)
library(lubridate)
# ----------- 1. Set Working Directory & Import Data -----------
setwd("C:/Users/KIOM_USER/Documents/GitHub/LongitudinalNC")
df <- read.csv("Chosun5yBIApreprocess.csv",
header = TRUE, stringsAsFactors = FALSE, na.strings = c("", "NA"))
# ----------- 2. Clean and Standardize COGNITIVESTAT -----------
df$COGNITIVESTAT <- df$COGNITIVESTAT %>%
str_replace_all("\\.", "") %>%   # Remove all dots
str_trim(side = "both")          # Remove spaces
# ----------- 3. Add Visit Count Per Subject -----------
df <- df %>%
add_count(USUBJID, name = "visit_count")
# ----------- 4. Filter Valid Cognitive Status & Re-Level -----------
df.long <- df %>%
filter(!is.na(COGNITIVESTAT) & COGNITIVESTAT != "") %>%
drop_na() %>%
add_count(USUBJID, name = "visit_count") %>%
mutate(
COGNITIVESTAT = case_when(
COGNITIVESTAT == "SMI" ~ "CN",
COGNITIVESTAT %in% c("aMCI", "naMCI") ~ "MCI",
TRUE ~ COGNITIVESTAT
)
)
# ----------- 5. Select Subjects with Multiple Visits -----------
df.long_multi <- df.long %>%
group_by(USUBJID) %>%
filter(n() >= 2) %>%
ungroup()
# ----------- 6. Calculate Transitions, Elapsed Time, and Change Types -----------
df_overall <- df.long_multi %>%
mutate(datetest = mdy(datetest)) %>%
arrange(USUBJID, datetest) %>%
group_by(USUBJID) %>%
mutate(
Initial_Status = first(COGNITIVESTAT),
Final_Status   = last(COGNITIVESTAT),
baseline_date  = first(datetest),
elapsed_years  = as.numeric(difftime(datetest, baseline_date, units = "days")) / 365.25,
Transition     = paste(Initial_Status, "->", Final_Status),
Change_Type    = case_when(
Initial_Status == "CN"  & Final_Status == "CN"  ~ "StableCN",
Initial_Status == "CN"  & Final_Status == "MCI" ~ "ProgressiveCN",
Initial_Status == "MCI" & Final_Status == "CN"  ~ "RevertedMCI",
Initial_Status == "MCI" & Final_Status == "MCI" ~ "StableMCI",
Initial_Status == "MCI" & Final_Status == "AD"  ~ "ProgressiveMCI",
Initial_Status == "AD"  & Final_Status == "MCI" ~ "RevertedAD",
Initial_Status == "AD"  & Final_Status == "AD"  ~ "StableAD",
TRUE                                             ~ NA_character_
)
) %>%
ungroup() %>%
select(-baseline_date)
# ----------- 7. Print The Output for Verification -----------
print(head(df_overall, 10))
# ----------- 8. Tạo df_long.analysis Với visit_count và Summary Transition -----------
# 1. Tạo df_long.analysis, đếm số lần tái khám per subject (USUBJID)
df_long.analysis <- df_overall %>%
add_count(USUBJID, name = "visit_count")
# 2. Tóm tắt số lượng và tỷ lệ phần trăm từng loại Transition (Change_Type)
transition_summary <- df_long.analysis %>%
group_by(Change_Type) %>%
summarise(
Count = n()
) %>%
mutate(
Percent = Count / sum(Count) * 100
) %>%
arrange(desc(Count))
# 3. In kết quả: Số lượng và % từng Transition, sắp theo Count giảm dần
print(transition_summary)
df_long.analysis <- df_overall %>%
add_count(USUBJID, name = "visit_count")
transition_summary <- df_long.analysis %>%
group_by(Change_Type) %>%
summarise(
Count = n()
) %>%
mutate(
Percent = Count / sum(Count) * 100
) %>%
arrange(desc(Count))
print(transition_summary)
